TRAIN_DATA=$(pwd)/data/adult.data.csv
EVAL_DATA=$(pwd)/data/adult.test.csv
MODEL_DIR=output

gcloud ml-engine local train \
    --module-name trainer.task \
    --package-path trainer/ \
    -- \
    --train-files $TRAIN_DATA \
    --eval-files $EVAL_DATA \
    --train-steps 1000 \
    --job-dir $MODEL_DIR \
    --eval-steps 100

tensorboard --logdir=output --port=8080

gcloud ml-engine local predict \
--model-dir=$MODEL_DIR/export/Servo/1505056497/ \
--json-instances \
data/test.json

# write to a file
gcloud ml-engine local predict \
--model-dir=$MODEL_DIR/export/Servo/1505056497/ \
--json-instances \
data/test.json > output.cabin.txt

# deploy to GCP as a new version
gcloud ml-engine versions create v2 --model=titanic --origin=$MODEL_BINARIES --staging-bucket=gs://titanic-model
# Create Version failed. Bad model detected with error: "Error loading the model: Could not load model. "

# send a prediction to GCP version
gcloud ml-engine predict \
--model titanic \
--version v2 \
--json-instances \
data/test.json

